/* ==========================================================================
   1. REGRAS GLOBAIS E VARIÁVEIS DE COR
   ========================================================================== */
* {
    box-sizing: border-box;
}

:root {
    --bg-dark: #1e1e2f;
    --bg-light: #f4f4f5;
    --text-dark: #e5e5e5;
    --text-light: #111;
    --card-bg-dark: #2a2a41;
    --card-bg-light: #ffffff;
    --border-dark: rgba(255, 255, 255, 0.1);
    --border-light: rgba(0, 0, 0, 0.1);
    --primary: #4f9cf9;
    --success: #34d399;
    --warn: #fbbf24;
    --danger: #f87171;
    --radius: 12px;
    --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

/* ==========================================================================
   2. LAYOUT PRINCIPAL (CORRIGIDO)
   ========================================================================== */

/* Trava o scroll da página e usa 100% da altura da tela */
html, body {
    height: 100vh; /* Usa 100% da altura da viewport */
    overflow: hidden; /* Impede o scroll no body */
}

/* Transforma o body em um container flex vertical */
body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-dark);
    color: var(--text-dark);
    transition: var(--transition);
    
    display: flex;
    flex-direction: column;
    min-height: 100vh; /* Garante a altura total */
}

/* Header: é o primeiro item flex, não encolhe */
header.header {
    width: 100%;
    padding: 16px 24px;
    background-color: var(--card-bg-dark);
    flex-shrink: 0; /* Impede que o header encolha */
    z-index: 10;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid var(--border-dark);
}

.header-inner {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
}

/* Regra para Headers (Padrão 3 colunas) */
.header-inner.header-inner--standard {
    display: grid;
    grid-template-columns: 1fr auto 1fr; /* Esquerda | Centro | Direita */
    gap: 20px;
}
.header-inner--standard .header-start { justify-self: start; }
.header-inner--standard .brand {
    text-align: center;
    font-weight: 700;
    font-size: 22px;
}
.header-inner--standard .header-actions { justify-self: flex-end; }

.header-actions {
    display: flex;
    align-items: center;
    gap: 16px;
}

/* Container: é o segundo item flex, cresce para preencher o espaço */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 32px 24px;
    
    flex-grow: 1; /* Faz o container crescer e preencher o espaço */
    width: 100%;
    
    /* Prepara o container para seu filho */
    display: flex;
    flex-direction: column;
    min-height: 0; /* Essencial para o flex-grow funcionar */
}

/* ==========================================================================
   3. COMPONENTES DE UI (Botões, Cards, etc)
   ========================================================================== */
.card {
    background-color: var(--card-bg-dark); padding: 28px; border-radius: var(--radius);
    text-decoration: none; color: var(--text-dark); display: flex; flex-direction: column;
    justify-content: center; align-items: center; transition: var(--transition);
    border: 1px solid var(--border-dark);
}
.card:hover { transform: translateY(-5px); border-color: var(--primary); background-color: rgba(79, 156, 249, 0.1); }
.card-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
.card-sub { font-size: 14px; color: #aaa; text-align: center; }

/* --- Formulários Globais --- */
label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; }
input, select, textarea {
    width: 100%; padding: 12px 14px; border-radius: var(--radius);
    border: 1px solid var(--border-dark); background-color: var(--bg-dark);
    color: var(--text-dark); font-size: 14px;
    margin-bottom: 12px;
    outline: none; transition: var(--transition);
}
input:focus, select:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 156, 249, 0.3); }
input[type="date"], input[type="datetime-local"] {
    color-scheme: dark;
}
label small {
    display: block; color: #aaa; font-size: 12px;
    margin-top: -8px; margin-bottom: 8px; font-weight: 400;
}


/* --- Botões --- */
.btn {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 10px 20px; border-radius: var(--radius); border: none; cursor: pointer;
    font-weight: 600; transition: var(--transition); font-size: 14px;
    text-decoration: none; white-space: nowrap;
}
.btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); }
.btn-primary { background-color: var(--primary); color: #fff; }
.btn-primary:hover { background-color: #3a8ef0; }
.btn-danger { background-color: var(--danger); color: #fff; }
.btn-danger:hover { background-color: #f65a5a; }
.btn-secondary { background-color: #6c757d; color: #fff; }
.btn-secondary:hover { background-color: #5a6268; }
.btn-warning { background-color: var(--warn); color: #111; }
.btn-warning:hover { background-color: #e6a800; }
.btn svg { width: 16px; height: 16px; margin-right: 8px; }

/* --- Botão de Tema e Voltar --- */
.theme-toggle {
    background: transparent; border: none; font-size: 24px; cursor: pointer;
    transition: transform 0.3s ease; color: var(--text-dark); padding: 0;
    display: flex; align-items: center; justify-content: center;
    width: 40px; height: 40px; border-radius: 50%;
}
.theme-toggle:hover { transform: scale(1.2) rotate(15deg); background-color: var(--card-bg-dark); }

body:not(.light) .theme-toggle .icon-sun { display: block; }
body:not(.light) .theme-toggle .icon-moon { display: none; }
body.light .theme-toggle .icon-sun { display: none; }
body.light .theme-toggle .icon-moon { display: block; }

.header .btn-header-voltar {
    background-color: var(--primary); color: #fff; border: none; padding: 10px 20px;
    border-radius: var(--radius); font-size: 14px; font-weight: 600; cursor: pointer;
    text-decoration: none; display: inline-flex; align-items: center; justify-content: center;
    transition: background-color 0.2s ease;
}
.header .btn-header-voltar:hover { background-color: #3a8ef0; }

/* ==========================================================================
   4. ESTILOS DE PÁGINAS ESPECÍFICAS
   ========================================================================== */

/* --- Layout de Grid Principal (Gestão e PDV) --- */
.gestao-container, .pdv-grid-container {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 24px;
    flex-grow: 1;
    min-height: 0;
    width: 100%;
    align-items: stretch; /* Garante colunas de altura igual */
}
/* Ajuste específico para gestão (lista na esquerda) */
.gestao-container {
    grid-template-columns: 380px 1fr;
}

/* --- Colunas (Regras Comuns para todos os layouts de 2 colunas) --- */
.lista-clientes, .form-cliente-wrapper,
.lista-produtos, .form-produto,
.produtos-container, .carrinho,
.lista-utilizadores, .form-utilizador-wrapper { /* Adicionado Utilizadores */
    background-color: var(--card-bg-dark);
    border-radius: var(--radius);
    padding: 24px;
    border: 1px solid var(--border-dark);
    max-height: none;
    min-height: 0; /* Essencial para scroll interno */
    display: flex;
    flex-direction: column;
}

/* --- Colunas com Scroll (Aplicado aos Wrappers) --- */
.lista-clientes,
.lista-produtos,
.form-produto,
.produtos-container,
.carrinho,
.lista-utilizadores, /* Adicionado Utilizadores */
.form-utilizador-wrapper, /* Adicionado Utilizadores */
.form-cliente-wrapper { /* Adicionado Cliente */
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) transparent;
}

/* --- Específico: Módulo Clientes e Utilizadores --- */
.lista-clientes ul, .lista-utilizadores ul { list-style-type: none; padding: 0; margin: 0; }
.cliente-item, .utilizador-item { padding: 12px; border-radius: 8px; cursor: pointer; transition: var(--transition); margin-bottom: 8px; border: 1px solid transparent; }
.cliente-item:hover, .utilizador-item:hover { background-color: rgba(79, 156, 249, 0.1); }
.cliente-item.active, .utilizador-item.active { background-color: rgba(79, 156, 249, 0.15); border-color: var(--primary); }
.cliente-item-nome, .utilizador-item-nome { font-weight: 600; display: block; }
.cliente-item-detalhes, .utilizador-item-detalhes { font-size: 12px; color: #aaa; display: block; margin-top: 4px; }
/* Placeholder comum */
.form-cliente-wrapper, .form-utilizador-wrapper { align-items: center; justify-content: center; } /* Centraliza placeholder */
#form-placeholder { text-align: center; color: #aaa; }
#form-placeholder svg { width: 60px; height: 60px; margin-bottom: 16px; }
/* Container do Formulário (interno) */
#form-container { width: 100%; height: 100%; display: flex; flex-direction: column; min-height: 0; }
#form-cliente, #form-utilizador { flex-grow: 1; display: flex; flex-direction: column; min-height: 0; }
/* Body do Formulário (Área de Scroll Interna para Cliente/Utilizador) */
.form-body {
    overflow-y: auto; /* Scroll SÓ AQUI dentro do form */
    scrollbar-width: thin;
    scrollbar-color: var(--primary) transparent;
    flex-grow: 1;
    padding-right: 10px;
    min-height: 0;
    /* Remove overflow do wrapper pai */
    /* ATENÇÃO: A sintaxe SASS original não funciona em CSS puro, ajuste manual */
    /* .form-cliente-wrapper { overflow-y: hidden; } */
    /* .form-utilizador-wrapper { overflow-y: hidden; } */
}
/* Fieldset e Legend padrão (para Clientes e Utilizadores) */
fieldset { border: none; padding: 0; margin: 0 0 24px 0; }
legend { font-size: 14px; font-weight: 600; color: #aaa; text-transform: uppercase; margin-bottom: 16px; padding-bottom: 8px; width: 100%; border-bottom: 1px solid var(--border-dark); }
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px 16px; }
.form-grid .full-width { grid-column: 1 / -1; }
.form-grid input { margin-bottom: 0 !important; }
.checkbox-container { display: flex; align-items: center; gap: 10px; }
.checkbox-container input { width: auto; margin-bottom: 0; }
.checkbox-container label { font-weight: normal; margin-bottom: 0; }
.form-actions { display: flex; gap: 12px; margin-top: auto; padding-top: 24px; justify-content: flex-end; border-top: 1px solid var(--border-dark); flex-shrink: 0; }

/* Específico para permissões em Utilizadores */
#permissoes-container { gap: 10px 16px; }
#permissoes-container .checkbox-container label { font-size: 13px; }


/* --- Específico: Módulo Produtos --- */
.lista-produtos ul { list-style-type: none; padding: 0; margin: 0; }
.produto-item { padding: 12px; border-radius: 8px; cursor: pointer; transition: var(--transition); margin-bottom: 8px; border: 1px solid transparent; }
.produto-item:hover { background-color: rgba(255,255,255,0.08); }
.produto-item.active { background-color: rgba(79,156,249,0.15); border-color: var(--primary); }
.produto-item-nome { font-weight: 600; display: block; }
.produto-item-detalhes { font-size: 12px; color: #aaa; display: block; margin-top: 4px; }
.form-produto h2 { font-size: 1.25rem; margin-top: 0; }
/* Fieldset e Legend estilo "Produtos" (SOBRESCRITA) */
.form-produto fieldset { border: 1px solid var(--border-dark); border-radius: var(--radius); padding: 25px 16px 16px 16px; margin-bottom: 16px; position: relative; }
.form-produto legend { position: absolute; top: -0.7em; left: 20px; padding: 0 5px; background-color: var(--card-bg-dark); font-weight: 700; color: #aaa; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: none; width: auto; margin-bottom: 0; padding-bottom: 0; }
.botoes-acao { display: flex; gap: 12px; margin-top: 16px; justify-content: flex-end; }
#preview-imagem { max-width: 100px; max-height: 100px; border-radius: 8px; margin-top: 10px; display: none; background-color: rgba(0,0,0,0.2); }

/* --- Específico: Módulo Relatórios --- */
.relatorios-painel { background-color: var(--card-bg-dark); border-radius: var(--radius); padding: 24px; box-shadow: var(--shadow); flex-grow: 1; min-height: 0; display: flex; flex-direction: column; }
.filtros-form { display: flex; flex-wrap: wrap; align-items: flex-end; gap: 16px; padding-bottom: 24px; border-bottom: 1px solid var(--border-dark); margin-bottom: 24px; flex-shrink: 0; }
.filtros-form > div { flex-grow: 1; }
.filtros-form button { flex-shrink: 0; }
#status-relatorio { text-align: center; color: #aaa; padding: 40px; flex-shrink: 0; }
#area-resultados { display: none; flex-grow: 1; min-height: 0; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--primary) transparent; }
.resultados-resumo { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
.resumo-metric { background-color: rgba(0,0,0,0.2); padding: 16px; border-radius: var(--radius); }
.resumo-metric-title { font-size: 14px; color: #aaa; margin-bottom: 8px; text-transform: uppercase; }
.resumo-metric-value { font-size: 28px; font-weight: 700; }
.tabela-relatorio { width: 100%; border-collapse: collapse; margin-top: 16px; }
.tabela-relatorio th, .tabela-relatorio td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-dark); }
.tabela-relatorio th { font-weight: 600; font-size: 14px; }
.tabela-relatorio tbody tr:hover { background-color: rgba(255,255,255,0.05); }

/* --- Específico: Módulo Lista de Pedidos --- */
.tabela-wrapper { flex-grow: 1; min-height: 0; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--primary) transparent; background-color: var(--card-bg-dark); border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border-dark); }
.tabela { width: 100%; border-collapse: collapse; }
.tabela th, .tabela td { padding: 16px; text-align: left; border-bottom: 1px solid var(--border-dark); }
.tabela th { font-weight: 600; font-size: 14px; text-transform: uppercase; color: #aaa; }
.tabela tbody tr:hover { background-color: rgba(79,156,249,0.1); }
.tabela tbody tr:last-child td { border-bottom: none; }
.tabela .btn { padding: 8px 12px; font-size: 12px; }

/* --- Específico: Módulo Controle de Mesas --- */
.mesas-wrapper { flex-grow: 1; min-height: 0; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--primary) transparent; padding: 5px; }
.mesas-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 24px; }
.mesa-card { background-color: var(--card-bg-dark); border-radius: var(--radius); padding: 16px; text-align: center; cursor: pointer; transition: all 0.2s ease-in-out; border: 2px solid #555; }
.mesa-card:hover { transform: translateY(-5px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
.mesa-card .numero { font-size: 16px; font-weight: 700; margin-top: 8px; }
.mesa-card .descricao { font-size: 12px; color: #aaa; min-height: 16px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.mesa-icon { width: 60px; height: 60px; transition: fill 0.3s; }
.status-livre { border-color: var(--success); }
.status-livre .mesa-icon { fill: var(--success); }
.status-ocupada { border-color: #0d6efd; }
.status-ocupada .mesa-icon { fill: #0d6efd; }
.status-em-fechamento { border-color: var(--danger); }
.status-em-fechamento .mesa-icon { fill: var(--danger); }
.status-reatendimento { border-color: var(--warn); }
.status-reatendimento .mesa-icon { fill: var(--warn); }

/* --- Específico: Módulo PDV --- */
.produtos-container { padding: 16px; }
.produtos-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 16px; }
.produto-card { background-color: var(--bg-dark); padding: 16px; border-radius: var(--radius); text-align: center; cursor: pointer; transition: var(--transition); border: 1px solid var(--border-dark); }
.produto-card:hover { transform: translateY(-5px); border-color: var(--primary); }
.produto-card-nome { font-weight: 600; font-size: 14px; margin-bottom: 8px; min-height: 40px; }
.produto-card-preco { font-size: 16px; color: var(--success); font-weight: 700; }
.carrinho { display: flex; flex-direction: column; }
.carrinho h2 { margin-top: 0; }
#form-venda { display: flex; flex-direction: column; flex-grow: 1; min-height: 0; }
.carrinho-itens-container { min-height: 150px; overflow-y: auto; margin: 16px 0; scrollbar-width: thin; scrollbar-color: var(--primary) transparent; padding-right: 5px; flex-grow: 1; }
.carrinho-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 14px; }
.carrinho-item-controles { display: flex; align-items: center; gap: 8px; }
.carrinho-item-controles button { background: var(--primary); color: #fff; border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; font-weight: bold; line-height: 24px; padding: 0; display: inline-flex; align-items: center; justify-content: center; }
.total-container { text-align: right; margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border-dark); flex-shrink: 0; }
.total-container small { text-transform: uppercase; color: #aaa; }
.total-container h2 { font-size: 28px; color: var(--success); margin: 0; }
.total-container .btn { margin-top: 16px; width: 100%; }
.pagamento-total { text-align: center; margin-bottom: 20px; }
.pagamento-total small { text-transform: uppercase; color: #aaa; }
.pagamento-total h1 { font-size: 42px; color: var(--success); margin: 5px 0; }
.troco-display { text-align: center; margin-top: 16px; font-size: 18px; color: var(--warn); font-weight: bold; min-height: 27px;}

/* --- Específico: Módulo Dashboard --- */
.page-title { font-size: 24px; font-weight: 700; margin-bottom: 24px; flex-shrink: 0; }
.dashboard-layout { display: grid; grid-template-columns: repeat(3, 1fr); grid-gap: 24px; flex-grow: 1; min-height: 0; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--primary) transparent; padding-right: 10px; padding-bottom: 10px; }
.metric-card, .chart-card, .list-card { background-color: var(--card-bg-dark); padding: 24px; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border-dark); }
.metric-card-title { font-size: 14px; color: #aaa; margin-bottom: 8px; text-transform: uppercase; }
.metric-card-value { font-size: 32px; font-weight: 700; }
.chart-card { grid-column: span 2; }
.chart-card h3, .list-card h3 { margin-top: 0; margin-bottom: 16px; font-size: 16px; }
#card-produtos-vendidos { grid-column: span 1; }
#card-ultimas-vendas { grid-column: span 2; }
#card-estoque-baixo { grid-column: span 1; }
.list-card ul { list-style: none; padding: 0; margin: 0; }
.list-card li { padding: 8px 0; border-bottom: 1px solid var(--border-dark); }
.list-card li:last-child { border-bottom: none; }
.stock-low { color: var(--warn); font-weight: bold; }

/* --- Específico: Módulo Configurações (gerado via JS no index.php) --- */
/* Grid de 2 colunas usado dentro do modal */
.grid-2-col {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px 24px;
}

/* --- Específico: Menu Principal (index.php) --- */
.main-menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; }
.main-menu-grid .card { padding: 24px; align-items: flex-start; text-align: left; height: 150px; display: flex; flex-direction: column; }
.card-icon { width: 40px; height: 40px; margin-bottom: 16px; color: var(--primary); }
.main-menu-grid .card-title { font-size: 16px; }
.main-menu-grid .card-sub { text-align: left; font-size: 13px; }
.card-destaque { background-color: var(--primary); color: #fff; border-color: var(--primary); }
.card-destaque .card-icon,
.card-destaque .card-title { color: #fff; }
.card-destaque .card-sub { color: rgba(255, 255, 255, 0.8); }
.card-destaque:hover { background-color: #3a8ef0; border-color: #3a8ef0; }

/* --- Menu do Utilizador --- */
.user-menu { position: relative; }
.user-menu-button { background: transparent; color: var(--text-dark); border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; line-height: 1; }
.user-menu-button:hover { background-color: rgba(255, 255, 255, 0.1); }
.user-menu-dropdown { display: none; position: absolute; top: 100%; left: 0; margin-top: 8px; background: var(--card-bg-dark); border-radius: var(--radius); box-shadow: var(--shadow); padding: 8px; width: 220px; z-index: 20; border: 1px solid var(--border-dark); }
.dropdown-header { padding: 10px 12px; border-bottom: 1px solid var(--border-dark); margin-bottom: 8px; }
.dropdown-header .user-name { font-weight: 600; }
.dropdown-header .user-role { font-size: 12px; color: #aaa; }
.user-menu-dropdown a { display: flex; align-items: center; gap: 8px; padding: 10px 12px; text-decoration: none; color: var(--text-dark); border-radius: 8px; font-size: 14px; cursor: pointer; }
.user-menu-dropdown a:hover { background-color: var(--primary); color: #fff; }


/* ==========================================================================
   5. TEMA CLARO (LIGHT MODE)
   ========================================================================== */
body.light { background-color: var(--bg-light); color: var(--text-light); }
body.light header.header { background-color: #fff; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); border-bottom: 1px solid var(--border-light); }
body.light .card { color: var(--text-light); background-color: var(--card-bg-light); border-color: var(--border-light); box-shadow: var(--shadow); }

/* Tema claro: garante destaque visivel no card ativo (ex: PDV / Vendas) */
body.light .card.card-destaque,
body.light .card-destaque {
    background-color: var(--primary) !important;
    border-color: var(--primary) !important;
    color: #fff !important;
}
body.light .card-destaque .card-icon,
body.light .card-destaque .card-title {
    color: #fff !important;
}
body.light .card-destaque .card-sub {
    color: rgba(255, 255, 255, 0.85) !important;
}
body.light .card-destaque:hover {
    background-color: #3a8ef0 !important;
    border-color: #3a8ef0 !important;
}
body.light input, body.light select, body.light textarea { background-color: #f8f9fa; color: var(--text-light); border-color: var(--border-light); }
body.light .theme-toggle { color: var(--text-light); }
body.light .theme-toggle:hover { background-color: #e9ecef; }
body.light input[type="date"], body.light input[type="datetime-local"] {
    color-scheme: light;
}

/* Regra de Tema Claro para Páginas de Gestão/PDV/Utilizadores */
body.light .lista-clientes, body.light .form-cliente-wrapper,
body.light .lista-produtos, body.light .form-produto,
body.light .produtos-container, body.light .carrinho,
body.light .lista-utilizadores, body.light .form-utilizador-wrapper {
    background-color: var(--card-bg-light); border-color: var(--border-light); box-shadow: var(--shadow);
}
body.light legend { border-color: var(--border-light); color: #6c757d; }
body.light .form-produto legend,
body.light .modal-box legend { /* Inclui config no modal */
    background-color: var(--card-bg-light);
}

/* Tema Claro para Relatórios */
body.light .relatorios-painel { background-color: var(--card-bg-light); box-shadow: var(--shadow); }
body.light .filtros-form { border-color: var(--border-light); }
body.light .resumo-metric { background-color: rgba(0,0,0,0.05); }
body.light .tabela-relatorio th,
body.light .tabela-relatorio td { border-color: var(--border-light); }
body.light .tabela-relatorio tbody tr:hover { background-color: rgba(0,0,0,0.03); }

/* Tema Claro para Lista de Pedidos */
body.light .tabela-wrapper { background-color: var(--card-bg-light); border-color: var(--border-light); box-shadow: var(--shadow); }
body.light .tabela th, body.light .tabela td { border-color: var(--border-light); }
body.light .tabela tbody tr:hover { background-color: rgba(0,0,0,0.03); }

/* Tema Claro para Controle de Mesas */
body.light .mesa-card { background-color: var(--card-bg-light); box-shadow: var(--shadow); border-color: var(--border-light); }
/* Removidas regras específicas de modal daqui, pois estão unificadas abaixo */

/* Tema Claro para PDV */
body.light .produto-card { background-color: #f8f9fa; border-color: var(--border-light); }
body.light .total-container,
body.light #form-venda hr { border-color: var(--border-light); }

/* Tema Claro para Dashboard */
body.light .metric-card,
body.light .chart-card,
body.light .list-card {
    background-color: var(--card-bg-light);
    border-color: var(--border-light);
    box-shadow: var(--shadow);
}
body.light .list-card li { border-color: var(--border-light); }

/* Tema Claro para Menu Principal */
body.light .user-menu-button { color: var(--text-light); }
body.light .user-menu-button:hover { background-color: #e9ecef; }
body.light .user-menu-dropdown { background: #fff; border-color: var(--border-light); }
body.light .dropdown-header { border-color: var(--border-light); }
body.light .user-menu-dropdown a { color: var(--text-light); }
body.light .user-menu-dropdown a:hover { background-color: var(--primary); color: #fff; }

/* ==========================================================================
   6. OUTROS COMPONENTES (Toast, Modal Global Unificado) - VERSÃO CORRIGIDA
   ========================================================================== */

/* --- Toast Notification --- */
#toast {
    position: fixed; bottom: -60px; /* Começa escondido em baixo */ left: 50%; transform: translateX(-50%);
    padding: 12px 24px; border-radius: var(--radius); color: #fff; z-index: 1000;
    opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease, bottom 0.3s ease; /* Adicionada transição 'bottom' */
    font-weight: 600; box-shadow: var(--shadow);
}
#toast.show {
    opacity: 1; visibility: visible;
    bottom: 20px; /* Sobe para a posição final */
}
#toast.sucesso { background-color: var(--success); }
#toast.erro { background-color: var(--danger); }

/* --- Modal Global Overlay (UNIFICADO) --- */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.7); /* Fundo escuro */
    z-index: 998; /* Abaixo do toast */

    /* Controlado pelo JavaScript via style.display = 'flex' ou 'none' */
    display: none;

    /* Centraliza o conteúdo (modal-box ou modal-content) */
    justify-content: center;
    align-items: center;

    /* (Opcional) Efeito de desfoque no fundo */
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px); /* Para Safari */
}

/* --- Estilo Base Comum para o CONTEÚDO do Modal --- */
/* Aplica-se tanto a .modal-content como a .modal-box */
.modal-content,
.modal-box {
    background: var(--card-bg-dark);
    color: var(--text-dark);
    border-radius: var(--radius);
    border: 1px solid var(--border-dark);
    box-shadow: var(--shadow);
    width: 90%; /* Largura padrão para mobile */
    overflow: hidden; /* Importante para o layout flex interno */

    /* Layout Flex para Cabeçalho/Corpo/Rodapé */
    display: flex;
    flex-direction: column;

    /* Limita o tamanho MÁXIMO */
    max-width: 500px; /* Largura máxima padrão */
    max-height: 90vh; /* Altura máxima padrão */
}

/* --- Variação: Modal Largo (.modal-box ou um modal específico) --- */
/* Use isto para Configurações, Fornecedores, etc. */
.modal-box, /* Aplica a todos os .modal-box por padrão */
#modal-fornecedores .modal-content /* Exemplo de ID específico se não usar .modal-box */
{
    max-width: 900px; /* Sobrescreve a largura máxima */
}


/* --- Cabeçalho do Modal (Comum) --- */
.modal-header {
    padding: 16px 24px;
    border-bottom: 1px solid var(--border-dark);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0; /* Não encolhe */
}
.modal-header h2, .modal-header h3 {
    margin: 0;
    font-size: 18px;
}
/* Botão de Fechar (Comum) */
.modal-close, .btn-fechar-modal {
    background: none; border: none;
    color: #aaa;
    font-size: 24px;
    cursor: pointer;
    line-height: 1;
    padding: 5px; /* Área de clique maior */
    transition: color 0.2s;
}
.modal-close:hover, .btn-fechar-modal:hover {
    color: var(--text-dark);
}


/* --- Corpo do Modal (Comum - Onde o Scroll Acontece) --- */
.modal-body {
    padding: 24px;
    padding-right: 10px; /* Espaço para scrollbar se aparecer */

    /* Scroll Vertical Automático */
    overflow-y: auto;
    overflow-x: hidden; /* Impede scroll horizontal */

    /* Estilo da scrollbar (opcional) */
    scrollbar-width: thin;
    scrollbar-color: var(--primary) transparent;

    /* Layout Flex: Faz o corpo crescer */
    flex-grow: 1;
    min-height: 0; /* ESSENCIAL para scroll funcionar */
}
/* Ajuste de padding quando a scrollbar não está visível (Opcional, pode remover se causar problemas) */
/*
.modal-body:not(:has(> :last-child:nth-child(2))) {
    padding-right: 24px;
}
*/

/* Estilos específicos DENTRO do modal-body (Ex: fieldsets das Configs) */
.modal-body fieldset {
    border: 1px solid var(--border-dark); border-radius: var(--radius);
    padding: 16px;
    padding-top: 24px;
    margin-bottom: 24px;
    position: relative;
}
.modal-body legend {
    position: absolute;
    top: -0.6em; left: 15px; padding: 0 5px;
    background-color: var(--card-bg-dark); /* Assume fundo escuro */
    font-weight: 700; color: #aaa; font-size: 12px;
    text-transform: uppercase; letter-spacing: 0.5px;
    border-bottom: none; width: auto; margin-bottom: 0; padding-bottom: 0;
}
.modal-body .grid-2-col {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px 24px;
}
.modal-body .grid-2-col input,
.modal-body .grid-2-col select { margin-bottom: 0; }
.modal-body .grid-2-col small { margin-bottom: 0; }


/* --- Rodapé do Modal (Comum) --- */
.modal-footer {
    padding: 16px 24px;
    border-top: 1px solid var(--border-dark);
    display: flex;
    justify-content: flex-end;
    flex-shrink: 0; /* Não encolhe */
    gap: 10px; /* Espaço entre botões */
}


/* --- Tema Claro para Modais (UNIFICADO) --- */
body.light .modal-content,
body.light .modal-box {
    background: #fff;
    color: var(--text-light);
    border-color: var(--border-light);
}
body.light .modal-header,
body.light .modal-footer,
body.light .modal-body fieldset {
    border-color: var(--border-light);
}
body.light .modal-close,
body.light .btn-fechar-modal {
    color: var(--text-light);
}
body.light .modal-body legend {
    background-color: #fff; /* Fundo claro para legenda */
    color: #6c757d;
}

/* --- Estilos específicos do Modal de Fornecedores (SE EXISTIREM) --- */
/* Cole aqui quaisquer estilos .fornecedor-item, etc., que possam ter sido apagados */
/* Exemplo: */
/*
.fornecedor-item { padding: 10px; border-bottom: 1px solid var(--border-dark); cursor: pointer; }
.fornecedor-item.active { background-color: rgba(79, 156, 249, 0.15); border-left: 3px solid var(--primary); padding-left: 7px; }
*/

/* ==========================================================
 * == ESTILOS PARA A PÁGINA /public/fechar_caixa.php (Layout Esticado e Mais Compacto) ==
 * ========================================================== */

/* Container geral da página */
.page-container.page-fechar-caixa {
    padding: 15px; /* Ainda mais reduzido */
    box-sizing: border-box;
    width: 100%;
}

/* Container do conteúdo principal */
.fechar-caixa-container {
    background: var(--surface);
    padding: 20px 25px; /* Reduzido */
    border-radius: 10px; /* Levemente menor */
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    width: 100%;
    margin: 1rem 0; /* Margem vertical pequena */
    box-sizing: border-box;
}

.fechar-caixa-container h1 {
    color: var(--text-primary); margin-bottom: 4px; text-align: center;
    font-size: 1.7em; /* Reduzido */
}
.fechar-caixa-container > p { 
    margin-bottom: 16px; /* Reduzido */
    color: var(--text-secondary); text-align: center;
    font-size: 0.9em; /* Reduzido */
}

/* Grid principal para os fieldsets */
.fechar-caixa-container .content-grid {
    display: grid; grid-template-columns: 1fr 1fr; 
    gap: 16px; /* Reduzido */
    align-items: start; 
}

/* Fieldsets */
.fechar-caixa-container fieldset {
    border: 1px solid var(--border-light); border-radius: 6px; /* Reduzido */
    padding: 12px 16px; /* Reduzido */
    margin-bottom: 0; box-sizing: border-box; height: 100%; 
}
.fechar-caixa-container legend {
    padding: 0 6px; /* Reduzido */
    font-weight: 600; color: var(--text-primary);
    font-size: 0.85em; /* Reduzido */
}

/* Grid dentro do Resumo */
.fechar-caixa-container .resumo-sistema-grid {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 10px; /* Reduzido */
    margin-bottom: 10px; /* Reduzido */
}
.fechar-caixa-container .resumo-sistema-grid.grid-col-1 { grid-template-columns: 1fr; }

/* Itens individuais do resumo */
.fechar-caixa-container .resumo-item {
    background-color: var(--background); padding: 6px 10px; /* Reduzido */
    border-radius: 4px; /* Reduzido */
}
.fechar-caixa-container .resumo-item small {
    display: block; color: var(--text-secondary);
    font-size: 0.75em; /* Reduzido */
    margin-bottom: 1px;
}
.fechar-caixa-container .resumo-item strong {
    display: block; color: var(--text-primary);
    font-size: 1.0em; /* Mantido (já era pequeno) */
    font-weight: 600;
}
.fechar-caixa-container .resumo-item.total-esperado strong { color: var(--primary); }

/* Linha separadora */
.fechar-caixa-container hr { margin: 12px 0; /* Reduzido */ }

/* Estilos do formulário de contagem */
.fechar-caixa-container .form-contagem .form-group {
    text-align: left; margin-bottom: 10px; /* Reduzido */
}
.fechar-caixa-container .form-contagem label {
    display: block; margin-bottom: 3px; /* Reduzido */
    font-weight: 600; font-size: 0.85em; /* Reduzido */
}
.fechar-caixa-container .form-contagem textarea { height: 50px; /* Reduzido */ }

/* Botões de Ação (Cancelar / Confirmar) */
.fechar-caixa-container .form-actions {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 10px; /* Reduzido */
    margin-top: 16px; /* Reduzido */
    grid-column: 1 / -1; 
}

/* Mensagem de Erro */
.fechar-caixa-container .erro-mensagem {
    background-color: var(--danger-light); color: var(--danger);
    padding: 8px; /* Reduzido */
    border-radius: 4px; margin-bottom: 12px; /* Reduzido */
    border: 1px solid var(--danger); text-align: center;
    font-size: 0.85em; /* Reduzido */
}

/* Responsividade */
@media (max-width: 900px) { 
    .fechar-caixa-container .content-grid {
        grid-template-columns: 1fr; gap: 12px; /* Reduzido */
    }
    .fechar-caixa-container fieldset { margin-bottom: 12px; } /* Reduzido */
     .fechar-caixa-container fieldset:last-of-type { margin-bottom: 0; }
}

@media (max-width: 600px) {
    .page-container.page-fechar-caixa { padding: 8px; } /* Reduzido */
    .fechar-caixa-container { padding: 16px 12px; margin: 0; } /* Reduzido */
    .fechar-caixa-container .resumo-sistema-grid { grid-template-columns: 1fr; gap: 8px; } 
    .fechar-caixa-container .form-actions { grid-template-columns: 1fr; gap: 8px;}
}


/* ==========================================================================
   7. MOBILE APP MODE (v1.5) — UI estilo aplicativo no celular
   - Botões maiores (toque)
   - Layout 1 coluna
   - Modais em formato "bottom-sheet"
   - Grids ajustados (menus/mesas/produtos)
   ========================================================================== */

/* Heurística: telas pequenas OU dispositivo de toque */
@media (max-width: 820px), (pointer: coarse) {
    :root {
        --radius-mobile: 16px;
    }

    html, body {
        height: 100%;
    }

    body {
        min-height: 100dvh;
        -webkit-text-size-adjust: 100%;
    }

    /* Containers */
    .container {
        padding: 12px !important;
    }

    /* Header estilo "app bar" */
    header.header {
        position: sticky;
        top: 0;
        z-index: 60;
        padding-top: env(safe-area-inset-top);
    }

    .header-inner--standard {
        display: grid !important;
        grid-template-columns: auto 1fr auto;
        gap: 10px;
        align-items: center;
    }

    .brand {
        font-size: 14px;
        letter-spacing: 0.5px;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .header-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: flex-end;
    }

    /* Touch targets */
    .btn,
    .header .btn-header-voltar,
    button,
    input,
    select,
    textarea {
        min-height: 48px;
        font-size: 16px; /* evita zoom no iOS */
    }

    .btn {
        padding: 12px 14px;
        border-radius: 14px;
    }

    .header .btn-header-voltar {
        padding: 10px 14px;
        border-radius: 14px;
    }

    .theme-toggle {
        width: 44px;
        height: 44px;
        font-size: 20px;
    }

    /* Layouts de 2 colunas viram 1 coluna no mobile */
    .gestao-container,
    .pdv-grid-container {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
    }

    /* Lista/colunas ficam mais "cart" */
    .lista-clientes, .form-cliente-wrapper,
    .lista-produtos, .form-produto,
    .produtos-container, .carrinho,
    .lista-utilizadores, .form-utilizador-wrapper,
    .metric-card, .chart-card, .list-card,
    .relatorios-painel,
    .tabela-wrapper {
        border-radius: var(--radius-mobile) !important;
        padding: 16px !important;
    }

    /* PDV — produtos maiores e grid 2 colunas no celular */
    .pdv-grid-container .produtos-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
        gap: 12px !important;
    }

    .pdv-grid-container .produto-card {
        min-height: 110px !important;
        padding: 14px !important;
        border-radius: 14px !important;
    }

    .pdv-grid-container .produto-card-nome {
        font-size: 0.95em !important;
    }

    .pdv-grid-container .carrinho-item-controles button {
        width: 34px;
        height: 34px;
        line-height: 34px;
        font-size: 18px;
    }

    /* Mesas — cards maiores */
    .mesas-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
        gap: 12px !important;
    }

    .mesa-card {
        padding: 14px !important;
        border-radius: var(--radius-mobile) !important;
    }

    .mesa-icon {
        width: 52px !important;
        height: 52px !important;
    }

    .mesa-card .numero {
        font-size: 18px !important;
    }

    .mesa-card .descricao {
        font-size: 13px !important;
    }

    /* Menu principal e dashboard */
    .main-menu-grid {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
    }

    .main-menu-grid .card {
        height: auto !important;
        min-height: 130px;
        border-radius: var(--radius-mobile) !important;
    }

    .dashboard-layout {
        grid-template-columns: 1fr !important;
        grid-gap: 12px !important;
        padding-right: 0 !important;
    }

    .chart-card,
    #card-ultimas-vendas,
    #card-produtos-vendidos {
        grid-column: auto !important;
    }

    /* Tabelas: permite arrastar horizontalmente no mobile */
    .tabela-wrapper,
    .comanda-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    .tabela,
    .tabela-relatorio {
        min-width: 520px; /* evita esmagar colunas */
    }

    /* Modais: bottom-sheet */
    .modal-overlay {
        align-items: flex-end !important;
        padding-bottom: env(safe-area-inset-bottom);
    }

    .modal-content,
    .modal-box {
        width: 100% !important;
        max-width: none !important;
        max-height: 92vh !important;
        border-radius: 18px 18px 0 0 !important;
        margin: 0 0 0 0 !important;
    }

    .modal-header {
        padding: 14px 16px !important;
    }

    .modal-body {
        padding: 14px 16px !important;
    }

    .modal-footer {
        position: sticky;
        bottom: 0;
        background: inherit;
        padding: 12px 16px !important;
        border-top: 1px solid var(--border-dark);
    }

    body.light .modal-footer {
        border-top-color: var(--border-light);
    }

    /* Toast mais "app" */
    #toast.show {
        bottom: calc(16px + env(safe-area-inset-bottom));
    }
}

/* Telas MUITO pequenas (ex.: 360px) */
@media (max-width: 420px) {
    .main-menu-grid {
        grid-template-columns: 1fr !important;
    }
    .mesas-grid {
        grid-template-columns: 1fr !important;
    }
    .pdv-grid-container .produtos-grid {
        grid-template-columns: 1fr !important;
    }
}
